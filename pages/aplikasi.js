import { GoogleMap, Marker, useLoadScript } from "@react-google-maps/api";
import Head from "next/head";
import Navbar from "../components/navbar";
import Footer from "../components/footer";

function initMap() {
  var select = document.getElementById("start");
  StartLocation = select.options[select.selectedIndex].value;
  if (StartLocation != -1) {
    // Reset all variable so it can be used again
    reset_condition();
    var map;
    var Path;
    // Create map in element with id "map"
    map = new google.maps.Map(document.getElementById("map"), {
      // Center: Kantor Camat Seririt
      zoom: 13,
      center: { lat: -8.192452, lng: 114.938026 },
      options: {
        fullscreenControl: false,
        zoomControl: false,
        keyboardShortcuts: false,
      },
    });
    // Add some marker according to data in public/js/marker.js
    map.data.addGeoJson(MarkerPosition);
    // Create polyline
    Path = new google.maps.Polyline({
      geodesic: true,
      strokeColor: "#FF0000",
      strokeOpacity: 1.0,
      strokeWeight: 2,
    });
    // Set polyline for specific map
    Path.setMap(map);
    // Retrieves the path
    Line = Path.getPath();
    // Start algorithm
    init();
    // Show path result
    create_element();
  } else {
    alert("Silakan pilih lokasi awal terlebih dahulu!");
  }
}

export default function Aplikasi() {
  const { isLoaded } = useLoadScript({
    googleMapsApiKey: process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,
  });
  if (!isLoaded) return <div>Maps loading...</div>;
  return (
    <>
      <Head>
        <title>Lagasin - Aplikasi</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/images/icon.ico" />
      </Head>
      <style jsx global>{`
        .aplikasi {
          color: white;
          font-weight: 700;
        }
        .beranda {
          font-weight: 400;
          --tw-text-opacity: 1;
          color: rgb(207 250 254 / var(--tw-text-opacity));
        }
        .informasi {
          font-weight: 400;
          --tw-text-opacity: 1;
          color: rgb(207 250 254 / var(--tw-text-opacity));
        }
      `}</style>
      <Navbar />
      <div className="bg-sky-50 mx-auto lg:px-16 xl:px-32 min-h-screen mb-8">
        <div className="pt-24 px-5">
          <h1
            data-aos="fade-down"
            className="text-sky-500 font-extrabold mb-3 text-xl md:text-2xl xl:text-3xl 2xl:text-4xl"
          >
            Lagasin
          </h1>
          <p data-aos="fade-right" className="my-3">
            Untuk menggunakan aplikasi Lagasin, pilih lokasi awal Anda. Lagasin
            akan memberikan rute puskesmas terdekat kepada Anda.
          </p>
          <div data-aos="fade-right" className="mb-3">
            <select
              id="start"
              className="p-2 rounded-md mr-2 border-blue-400 border-2"
            >
              <option value={-1}>-Silakan pilih lokasi-</option>
              <option value={0}>Kantor Camat</option>
              <option value={1}>Puskesmas Seririt 1</option>
              <option value={2}>Puskesmas Seririt 2</option>
              <option value={3}>Puskesmas Seririt 3</option>
              <option value={4}>RS Pratama</option>
              <option value={5}>RS Santi Graha</option>
            </select>
            <button
              onClick={initMap}
              className="rounded-md bg-sky-400 p-2 text-md font-bold text-white hover:bg-sky-500 shadow-sm hover:shadow-md"
              id="submit"
            >
              Hitung
            </button>
          </div>
          <div id="div-result">
            <p
              id="result"
              className="bg-white p-1 border border-blue-400 rounded-md hidden"
            ></p>
          </div>
          <div
            data-aos="fade-right"
            className="bg-sky-300 w-fit px-2 py-0.5 rounded-md mb-3 mt-3"
          >
            <details>
              <summary className="font-bold">Catatan:</summary>
              <p className="text-xs leading-6">
                Jika muncul pesan{" "}
                <kbd className="rounded-md bg-white py-0.5 px-1 font-bold text-black">
                  This page can&apos;t load Google Maps correctly
                </kbd>{" "}
                pada Google Maps, silakan klik tombol{" "}
                <kbd className="rounded-md bg-white py-0.5 px-1 font-bold text-black">
                  OK
                </kbd>
              </p>
            </details>
          </div>
          <div
            data-aos="fade-up"
            id="map"
            className="w-ful min-h-screen shadow-md rounded-md"
          >
            <GoogleMap
              zoom={13}
              center={{ lat: -8.192452, lng: 114.938026 }}
              options={{
                fullscreenControl: false,
                zoomControl: false,
                keyboardShortcuts: false,
              }}
              mapContainerClassName="w-full min-h-screen shadow-md rounded-md"
            >
              <Marker position={{ lat: -8.192452, lng: 114.938026 }} />
              <Marker position={{ lat: -8.192828, lng: 114.936633 }} />
              <Marker position={{ lat: -8.203176, lng: 114.886372 }} />
              <Marker position={{ lat: -8.223675, lng: 114.942618 }} />
              <Marker position={{ lat: -8.191781, lng: 114.950825 }} />
              <Marker position={{ lat: -8.19579, lng: 114.943202 }} />
            </GoogleMap>
          </div>
        </div>
      </div>
      <Footer />
    </>
  );
}
